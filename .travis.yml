language: python
sudo: false
cache: pip
dist: xenial

matrix:
  include:
    - python: 3.5
      env:
        - TOXENV=py35,codecov
    - python: 3.6
      env:
        - TOXENV=py36,codecov
    - python: 3.7
      env:
        - TOXENV=py37,check,codecov
    - python: 3.8
      env:
        - TOXENV=py38,check,codecov

before_install:
  - python --version
  - uname -a
  - lsb_release -a

install:
  - pip install tox
  - pip install coverage
  - virtualenv --version
  - easy_install --version
  - pip --version
  - tox --version

script:
  - tox -v

after_failure:
  - more .tox/log/* | cat
  - more .tox/*/log/* | cat

notifications:
  email:
    on_success: never
    on_failure: always

# Deploy: disable jekyll in order to publish subfolders with leading underscores as well to pages
before_deploy:
  - mkdir -p doc/_build/html/
  - touch doc/_build/html/.nojekyll
deploy:
  # production pypi
  - provider: pypi
    distributions: sdist bdist_wheel
    user: __token__
    password:
      secure: nJg5xDQJOQtSVaEGuWANiLS5rOHVTY/woEDoK7XAYXPv3bVvgRvlrpnc/xDaBAMknu2wxUQGtRGMFmFzfxmdug/5KsKGW0Wswf7QG/QnQiHX1lYFN44eAkdIBbm0yv5okbZwHt32X1cI9YDEVuz8+CPlAZHh8eyEn/mdUagOKetIAu3GCWltBKwWPIchfU90QrePOWyPTgQeG8V2bRTqy5mHWhRLmYq3U6VJM8pwdnzESwd1fz03w0t0hgkm1UfHxd8Adn8ciL2d/g1JIPHRZkyEoklabDS6/mrtFX0zHoeU7tMfr7Imq5fWD3FdC1g2KEqO2H1LjiSiEhpISx6ImnGID63piWEZGlw6gWmCpB7s8RfxNeit5SFdWziFKV9UjuhaGhsG+yS1bJhnTNYUM2xcbOVnHgvMPbdL32LUvV7EH8XDpIXk5onkra9DaXg/ljzXMlohMDjn+nItxZGepGZKHOtB95nznr9ylGGIvNifkLdWqr0Dp2yP3AYIiuG5R4zSm4sl14tZE6yg8VJwZ1uglQdePY++SJJCuUHSolL0jqc24+03scLWkton3iS4rM4RewrqF9A9GpBQLjree14gfipR3KNM9Y1Yv7fCYJd/tzvF14UhjFHbMV4DXI6O1fSYRI9u30JzhGYQoFS1QcjihfjegswStH2vFZGK9D4=
    on:
      branch: master
      python: 3.6
      tags: true
  # publish documentation: built by tox, published to pages
  - provider: pages
    skip_cleanup: true
    local_dir: doc/_build/html/
    github_token: $GITHUB_TOKEN
    on:
      branch: master
      python: 3.6
