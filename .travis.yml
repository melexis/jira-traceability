language: python
sudo: false
cache: pip
dist: xenial

matrix:
  include:
    - python: 3.5
      env:
        - TOXENV=py35,codecov
    - python: 3.6
      env:
        - TOXENV=py36,codecov
    - python: 3.7
      env:
        - TOXENV=py37,check,codecov
    - python: 3.8
      env:
        - TOXENV=py38,check,codecov

before_install:
  - python --version
  - uname -a
  - lsb_release -a

install:
  - pip install tox
  - pip install coverage
  - virtualenv --version
  - easy_install --version
  - pip --version
  - tox --version

script:
  - tox -v

after_failure:
  - more .tox/log/* | cat
  - more .tox/*/log/* | cat

notifications:
  email:
    on_success: never
    on_failure: always

# Deploy: disable jekyll in order to publish subfolders with leading underscores as well to pages
before_deploy:
  - mkdir -p doc/_build/html/
  - touch doc/_build/html/.nojekyll
deploy:
  # production pypi
  - provider: pypi
    distributions: sdist bdist_wheel
    user: __token__
    password:
      secure: PDGc4lYlOlpZlMgqZzh1OG2CdKOL9XVGTRAySjsiHgnPnPyMYSEKbLhI0NkoDW9QYo1NDJpFuhScbfnbILCfcfnCDlu7GHzDH1/nGytvHDvfTLe7kEquOBt3uIoIA0stGRJCotECwyhgYODGRUolsAVnRjhJvm0QEfnThzdCNQm0u3wgs2lgYYhRiyAsrwOGmqD7WPOPHr1qNKG35YpcOLAVX9YfIxZm4qnEkNra0+vEId/r4IJIUcvIq0ON1Td9Rl4IhtIZ31kk3pXTxI0RITa+sWUzMY3UmdBSar5XhHt16EYm8UUt749NrWYIRXTzS5djaFI9RboO0wFMbX4vj0sZCB8K6Qsiq+R8LZ+DWxzNn5sffYuwhVy06QuZMmXo3d2g3TSlnWsuodcJ67R/Sc/2/IrkCJXvFx/wCSfTBg18PlJQxIA7AtdeP9hHSt5t3dOEzsjtA5nP+8/jcMNWw55xjJTVCDonJdMQjvFnGl+a8rrpLhcHqkOZ+9XNP9cqTBOHqJsQ7emPt69d1nwUVFM4a7Qae+RNg4Mq1md2wxkprMaGX8oQMMZrriMcANHG8c8zabcAMyHyokkmY66pxefafL8Ub5exYZ8IX2DgBC6A8/GFm2a0a2lYSJTcr3mmBwbbLl7Q2yYxPhfb6gSBReEiodWfmrB3GR1H/ircrKg=
    on:
      branch: master
      python: 3.7
      tags: true
  # publish documentation: built by tox, published to pages
  - provider: pages
    skip_cleanup: true
    local_dir: doc/_build/html/
    github_token: $GITHUB_TOKEN
    on:
      branch: master
      python: 3.6
